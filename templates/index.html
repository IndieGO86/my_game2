<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8"/>
  <title>–ò–≥—Ä–∞</title>
  <style>
    body { 
      background:#121212; 
      color:#eee; 
      font-family: sans-serif; 
      margin:0; 
      padding:20px;
    }
    
    .layout { 
      display:flex; 
      gap:20px; 
    }
    
    .left, .right { 
      width:280px; 
    }
    
    .field { 
      flex:1; 
      min-height:500px; 
      background:#2a2a2a; 
      border-radius:12px; 
      display:flex; 
      justify-content:center; 
      align-items:center; 
      color:#888; 
    }
    
    .card { 
      background:#1e1e1e; 
      padding:16px; 
      border-radius:10px; 
      box-shadow:0 0 12px rgba(0,0,0,0.6); 
    }
    
    .avatar { 
      position:fixed; 
      top:10px; 
      left:10px; 
      background:#1e1e1e; 
      padding:10px; 
      border-radius:8px; 
      z-index:100; 
    }
    
    .avatar img {
      border: 2px solid #f4c542;
      box-shadow: 0 0 5px rgba(220, 55, 55, 0.3);
    }
    
    .logout-form { 
      margin-top:8px; 
    }
    
    a { 
      color:#78c7ff; 
      text-decoration:none; 
    }
    
    /* –°—Ç–∏–ª–∏ –¥–ª—è –∫–∞—Ä—Ç–æ—á–µ–∫ */
    .card.default {
      border: 2px solid #444;
      box-shadow: 0 0 12px rgba(0,0,0,0.6);
    }

    .card.modern {
      border: none;
      box-shadow: 0 0 20px rgba(255,255,255,0.1);
    }

    .card.fantasy {
      font-family: 'Times New Roman', serif;
      border: 2px solid #8B4513;
      background-image: linear-gradient(to bottom right, #f5f5dc, #e6d9b8);
      color: #5c2e0d;
    }

    .flash {
      margin-bottom:8px;
      padding:10px;
      border-radius:6px;
      font-weight:bold;
      color:#fff;
    }
    .flash.error { background:red; }
    .flash.success { background:green; }
  </style>
</head>
<body>
    <!-- –°–æ–æ–±—â–µ–Ω–∏—è flash -->
  {% with messages = get_flashed_messages(with_categories=True) %}
    {% if messages %}
      {% for category, message in messages %}
        <div class="flash {{ category }}">
          {{ message }}
        </div>
      {% endfor %}
    {% endif %}
  {% endwith %}

  {% if player %}
  <div class="avatar">
    <div style="display: flex; align-items: center; gap: 10px;">
      <img src="{{ url_for('static', filename='avatars/' + (player.avatar_url if player.avatar_url else 'default.png')) }}"
          style="width: 40px; height: 40px; border-radius: 50%; object-fit: cover;">
      <div>
        <strong>{{ player.name }}</strong><br>
        <small>{{ player.race }} ‚Äî {{ player.player_class }}</small>
      </div>
    
    </div>
    <form class="logout-form" method="post" action="{{ url_for('logout') }}">
      <button type="submit">–í—ã–π—Ç–∏</button>
    </form>
  </div>
  {% endif %}

  {% if player %}
    <h1>–ò–ì–†–ê</h1>
    <div class="layout">

      <div class="left">
        <div class="card {{ player.card_style }}" 
             style="--bg-color: {{ player.theme_color }}; background-color: var(--bg-color);">
          <h3>{{ player.name }}</h3>
          <div>–†–∞—Å–∞: {{ player.race }}</div>
          <div>–ö–ª–∞—Å—Å: {{ player.player_class }}</div>
          <div>–£—Ä–æ–≤–µ–Ω—å: {{ player.level or 1 }}</div>
          <div>HP: {{ player.health }}</div>
          {% if player.energy is not none %}
            <div>–≠–Ω–µ—Ä–≥–∏—è: {{ player.energy }}</div>
          {% elif player.mana is not none %}
            <div>–ú–∞–Ω–∞: {{ player.mana }}</div>
          {% endif %}
          {% if player.bio %}
          <div style="margin-top:10px; padding:8px; background:rgba(0,0,0,0.3); border-radius:6px;">
            {{ player.bio }}
          </div>
          {% endif %}
          <div>–ó–æ–ª–æ—Ç–æ: {{ player.gold }}</div>
          <div style="margin-top:10px;"><a href="{{ url_for('profile') }}">–õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç</a></div>
        </div>
      </div>

      <div class="field">–ò–≥—Ä–æ–≤–æ–µ –ø–æ–ª–µ</div>

      <div class="right">
        <div class="card">
          <h3>–î—Ä—É–≥–∏–µ –∏–≥—Ä–æ–∫–∏</h3>
          {% for op in other_players %}
            <div style="padding:8px 0; border-bottom:1px solid #333;">
              <strong>{{ op.name }}</strong><br>
              <small>{{ op.race }} ‚Äî {{ op.player_class }}</small>
            </div>
          {% else %}
            <p>–ü–æ–∫–∞ –Ω–∏–∫—Ç–æ –Ω–µ –∏–≥—Ä–∞–µ—Ç</p>
          {% endfor %}
        </div>
      </div>
    </div>

  {% elif show_auth %}
    <!-- –û–≤–µ—Ä–ª–µ–π –≤—Ö–æ–¥–∞/—Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ -->
    <div style="position:fixed; top:0; left:0; width:100vw; height:100vh; background:rgba(0,0,0,0.75); display:flex; align-items:center; justify-content:center; z-index:999;">
      <div class="card" style="width:320px;">
        
        <h3 style="text-align:center;">–í—Ö–æ–¥ –≤ –∏–≥—Ä—É</h3>

        <form method="post" action="{{ url_for('login') }}">
          <input name="name" placeholder="–í–≤–µ–¥–∏—Ç–µ –∏–º—è" required style="width:100%; padding:8px; margin-bottom:10px;">
          <div style="display:flex; gap:5px;">
            <input type="password" name="password" id="login-password" placeholder="–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å" required style="flex:1; padding:8px;">
            <button type="button" onclick="toggleLoginPassword()" style="padding:8px;">üëÅ</button>
          </div>
          <button style="width:100%; padding:8px; margin-top:10px;">–í–æ–π—Ç–∏</button>
        </form>
          <script>
            function toggleLoginPassword() {
              const field = document.getElementById("login-password");
              field.type = field.type === "password" ? "text" : "password";
          }
          </script>

        <div style="text-align:center; margin-top:10px;">
          –ù–æ–≤—ã–π –∏–≥—Ä–æ–∫? <a href="{{ url_for('register') }}">–°–æ–∑–¥–∞—Ç—å</a>
        </div>
      </div>
    </div>
  {% endif %}

</body>
</html>